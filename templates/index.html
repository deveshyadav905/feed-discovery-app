<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Feed & Sitemap Discovery</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">

<div class="container">
  <h2 class="mb-4">Feed & Sitemap Discovery</h2>

  <form id="discoverForm" class="mb-3">
    <input class="form-control mb-2" name="domain" placeholder="example.com" required>
    <button class="btn btn-primary" type="submit">Discover</button>
  </form>

  <div id="status" class="mb-2 text-muted"></div>

  <table class="table table-bordered d-none" id="resultTable">
    <thead>
      <tr>
        <th>URL</th>
        <th>Type</th>
        <th>Source</th>
      </tr>
    </thead>
    <tbody id="resultBody"></tbody>
  </table>
</div>

<script>
const form = document.getElementById("discoverForm");
const status = document.getElementById("status");
const table = document.getElementById("resultTable");
const body = document.getElementById("resultBody");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  status.textContent = "Discovering feedsâ€¦";
  table.classList.add("d-none");
  body.innerHTML = "";

  const formData = new FormData(form);

  const response = await fetch("/discover", {
    method: "POST",
    body: formData
  });

  const data = await response.json();

  status.textContent = `Found ${data.count} sources`;

  data.results.forEach(r => {
    const row = `
      <tr>
        <td><a href="${r.url}" target="_blank">${r.url}</a></td>
        <td>${r.type}</td>
        <td>${r.source}</td>
      </tr>
    `;
    body.insertAdjacentHTML("beforeend", row);
  });

  table.classList.remove("d-none");
});
</script>

</body>
</html>
